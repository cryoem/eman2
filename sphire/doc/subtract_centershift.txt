~~NOTOC~~

===== sp_signalsubtract centershift =====

Center Map : Center map of remaining density.

\\
===== Usage =====

Usage in command line

  	sp_signalsubtract.py centershift --cvol1=map_center_1 --cvol2=map_center_2 --shiftparams=shift_parameters --diffimgs=images_to_subtract --outdir=output_subtraction_directory --volradius=map_radius --apix=pixel_size --verbosity=verbosity_level


\\
===== Typical usage =====

sp_signalsubtract comprises the steps needed to subtract masked regions from a map in order to focus on the remaining features from that map.  There are six steps for this process (five within SPHIRE):

\\ __1. Average and low-pass filter a map for segmentation __

\\ __2. Locate regions to be subtracted __

\\ __3. Mask a soft mask of the region to be excluded __

\\ __4. Compute re-projections of map to be subtracted, and subtract them from the original images __

\\ __5. Compute reconstruction of density remaining after signal-subtraction __

\\ __6. Center map of the remaining density __:

  sp_signalsubtract.py --mode centershift --cvol1=centered_halfmap_1 --cvol2=centered_halfmap_2 --shiftparams=meridien_parameters --diffimgs bdb:output_subtraction_directory#all_subtracted --outdir=output_subtraction_directory --apix=pixel_size --volradius=structure_radius

As inputs "--cvol1" and "--cvol2", use the half-maps generated by the previous reconstruction step.  For "--shiftparams", use the Meridien parameters for the iteration used for those reconstructions. e.g., of the form "final_params_015.txt".  For "--diffimgs", use the signal-subtracted image stack from above. 

The reconstruction will be roughly centered by alignment to a Gaussian blob of radius specified by the flag "--volradius". (Additional centering options will be provided in the future.) If the pixel size is provided (--apix), the units of radius will be assumed to be in Angstroms. If the pixel size is not provided, the radius will be assumed to be in units of voxels. If your structure is not globular, try the shortest dimension.

The output centered parameter file will be combine the Meridien parameters with the centering parameters.  The output reconstruction will not use smear information, and may be noisier than the reconstruction from the previous step. Simply make sure that the centering was adequate. The better the centering, the smaller the required shifts will be in subsequent refinements.

\\
===== Input =====
=== Main Parameters ===
  ; %%--%%cvol1 : Center map #1 : First map to average and center. (default None) : subtraction_mode==centershift
  ; %%--%%cvol2 : Center map #2 : Second map to average and center. (default None) : subtraction_mode==centershift
  ; %%--%%shiftparams : Shift parameters : Meridien parameters to combine with centering parameters. (default None) : subtraction_mode==centershift
  ; %%--%%diffimgs : Subtracted images : Images from signal subtraction to reconstruct. (default None) : subtraction_mode==centershift
  ; %%--%%outdir : Output directory : Directory where outputs will be written. (default required string)
  ; %%--%%volradius : Structure radius : Radius to use for centering reconstruction. If the structure is not globular, try the shortest dimension. (default None) : subtraction_mode==centershift
  ; %%--%%apix : Pixel size : Pixel size in Angstroms. (default None)
  
\\
=== Advanced Parameters ===
  ; %%--%%verbosity : Verbosity level : Controls how much information will be written to the screen. (default 2)
  
\\
===== Output =====
  ; vol001_average.hdf : Reconstruction of subtracted particles
  ; vol002_inverted.hdf : Negative of above reconstruction, subtracted region shouldn't have significant densities
  ; vol003_centered.hdf : Centered reconstruction
  ; params004_to_be_centered.txt : Original parameters
  ; params005_centered.txt : Parameters after centering
 
\\
===== Description =====

\\
==== Method ====

\\
==== Reference ====

\\
==== Developer Notes ====

\\
==== Author / Maintainer ====
Tapu Shaikh

\\
==== Keywords ====
Category 1:: APPLICATIONS

\\
==== Files ====
sphire/bin/sp_signalsubtract.py

\\
==== See also ====

\\
==== Maturity ====
Beta:: Under evaluation and testing. Please let us know if there are any bugs.

\\
==== Bugs ====

\\
